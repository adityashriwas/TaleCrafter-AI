const {
  GoogleGenerativeAI,
  HarmCategory,
  HarmBlockThreshold,
} = require("@google/generative-ai");

const apiKey = process.env.NEXT_PUBLIC_GEMINI_API_KEY;
const genAI = new GoogleGenerativeAI(apiKey);

const model = genAI.getGenerativeModel({
  model: process.env.NEXT_PUBLIC_GEMINI_MODEL ?? "gemini-2.5-flash",
});

const generationConfig = {
  temperature: 1,
  topP: 0.95,
  topK: 40,
  maxOutputTokens: 8192,
  responseMimeType: "application/json",
};

  export const chatSession = model.startChat({
    generationConfig,
    history: [
      {
        role: "user",
        parts: [
          {text: "Create a horror-themed story for a mature audience with 20 to 25 chapters. Each chapter should include a text description, character details, and an image prompt in an anime style. The character descriptions should remain consistent throughout the story. i want that if a character is needed in any chapter than before scene his description would be injected in the url so that the character would be consistent througout the book The image prompt should be formatted into a URL where spaces are replaced by hyphens (-), ensuring uniformity across all images.\nfor example\n\n{\n  \"title\": \"The Cursed Academy\",\n  \"coverImagePrompt\": \"anime style dark horror book cover. A young boy with terrified eyes stands in front of an old gothic school, surrounded by mystical glowing symbols. The sky is dark and thunderous, and shadowy figures lurk in the background.\",\n  \"characterDescriptions\": {\n    \"character1\": \"Yuki - A 16-year-old boy with short messy black hair, piercing blue eyes, and a mysterious aura. Wears a dark school uniform with a silver emblem. Has an ancient scar on his wrist glowing under moonlight.\",\n    \"character2\": \"Professor Kaede - A middle-aged man with silver hair, half-moon glasses, and a long black coat. His face is pale, and he carries a worn-out book with cryptic symbols.\",\n    \"character3\": \"Akari - A young girl with long crimson hair, deep red eyes, and a black choker. She wears a gothic-style school uniform and carries a lantern that reveals hidden spirits.\"\n  },\n  \"chapters\": [\n    {\n      \"chapterNumber\": 1,\n      \"title\": \"Arrival at the Haunted School\",\n      \"textPrompt\": \"Yuki arrives at the mysterious Kuroyami Academy, unaware of the dark secrets hidden within its walls. He meets Akari and Professor Kaede, who hint at the school’s sinister past. Strange whispers fill the air as the students enter the main hall...\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-A-young-boy-and-girl-standing-before-a-gothic-school,-with-cursed-symbols-glowing-on-the-walls,-and-shadowy-figures-hiding-in-the-background.\"\n    },\n    {\n      \"chapterNumber\": 2,\n      \"title\": \"The Forbidden Library\",\n      \"textPrompt\": \"Yuki and Akari sneak into the restricted section of the library. They discover an ancient book that speaks of a curse binding the souls of former students. As they read, the room darkens, and eerie voices whisper around them...\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-A-dimly-lit-library-filled-with-ancient-books,-whispering-shadows-hovering-over-the-characters,-and-a-glowing-curse-symbol-on-the-open-book.\"\n    },\n    {\n      \"chapterNumber\": 3,\n      \"title\": \"The First Nightmare\",\n      \"textPrompt\": \"That night, Yuki has a terrifying dream of faceless students walking towards him, chanting in an unknown language. He wakes up sweating, only to find his window open despite locking it before bed...\",\n      \"imagePrompt\": \"Yuki,-anime-style,-dark-horror-illustration.-A-young-boy-sweating-in-fear,-sitting-on-his-bed,-with-a-dark-figure-outside-his-window,-and-a-haunting-mist-filling-the-room.\"\n    },\n    {\n      \"chapterNumber\": 4,\n      \"title\": \"Secrets in the Basement\",\n      \"textPrompt\": \"Akari leads Yuki to a hidden door in the school basement. As they descend, they find ancient chains and eerie paintings of past students. The air grows colder as a deep growl echoes through the darkness...\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-Two-students-standing-in-a-dark-basement,-holding-a-lantern,-with-ancient-chains-hanging-from-the-walls-and-shadows-moving-in-the-darkness.\"\n    }\n  ]\n}\n"},
        ],
      },
      {
        role: "model",
        parts: [
          {text: "I am unable to generate images directly. The capability is only enabled for the \"Gemini 2.0 Flash Experimental\" model when the selected output format is \"Images and text\". However, I can provide you with the requested horror story structure including character descriptions, text prompts, and image prompts formatted as URLs, ready for use with an AI image generator.\n\nHere's the horror story outline, \"The Cursed Academy,\" structured as requested:\n\n```json\n{\n  \"title\": \"The Cursed Academy\",\n  \"coverImagePrompt\": \"anime-style-dark-horror-book-cover.-A-young-boy-with-terrified-eyes-stands-in-front-of-an-old-gothic-school,-surrounded-by-mystical-glowing-symbols.-The-sky-is-dark-and-thunderous,-and-shadowy-figures-lurk-in-the-background.\",\n  \"characterDescriptions\": {\n    \"character1\": \"Yuki - A 16-year-old boy with short messy black hair, piercing blue eyes, and a mysterious aura. Wears a dark school uniform with a silver emblem. Has an ancient scar on his wrist glowing under moonlight.\",\n    \"character2\": \"Professor Kaede - A middle-aged man with silver hair, half-moon glasses, and a long black coat. His face is pale, and he carries a worn-out book with cryptic symbols.\",\n    \"character3\": \"Akari - A young girl with long crimson hair, deep red eyes, and a black choker. She wears a gothic-style school uniform and carries a lantern that reveals hidden spirits.\",\n    \"character4\": \"Ren - An 18-year-old student council president with long, flowing black hair, cold grey eyes, and an air of authority.  Wears a pristine white uniform with gold trim.  Hides a dark secret.\",\n    \"character5\": \"The Entity - A shapeless being of pure darkness, with glowing red eyes. Its presence causes madness and despair.\"\n  },\n  \"chapters\": [\n    {\n      \"chapterNumber\": 1,\n      \"title\": \"Arrival at the Haunted School\",\n      \"textPrompt\": \"Yuki arrives at the mysterious Kuroyami Academy, unaware of the dark secrets hidden within its walls. He meets Akari and Professor Kaede, who hint at the school’s sinister past. Strange whispers fill the air as the students enter the main hall...\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-A-young-boy-and-girl-standing-before-a-gothic-school,-with-cursed-symbols-glowing-on-the-walls,-and-shadowy-figures-hiding-in-the-background.\"\n    },\n    {\n      \"chapterNumber\": 2,\n      \"title\": \"The Forbidden Library\",\n      \"textPrompt\": \"Yuki and Akari sneak into the restricted section of the library. They discover an ancient book that speaks of a curse binding the souls of former students. As they read, the room darkens, and eerie voices whisper around them...\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-A-dimly-lit-library-filled-with-ancient-books,-whispering-shadows-hovering-over-the-characters,-and-a-glowing-curse-symbol-on-the-open-book.\"\n    },\n    {\n      \"chapterNumber\": 3,\n      \"title\": \"The First Nightmare\",\n      \"textPrompt\": \"That night, Yuki has a terrifying dream of faceless students walking towards him, chanting in an unknown language. He wakes up sweating, only to find his window open despite locking it before bed...\",\n      \"imagePrompt\": \"Yuki,-anime-style,-dark-horror-illustration.-A-young-boy-sweating-in-fear,-sitting-on-his-bed,-with-a-dark-figure-outside-his-window,-and-a-haunting-mist-filling-the-room.\"\n    },\n    {\n      \"chapterNumber\": 4,\n      \"title\": \"Secrets in the Basement\",\n      \"textPrompt\": \"Akari leads Yuki to a hidden door in the school basement. As they descend, they find ancient chains and eerie paintings of past students. The air grows colder as a deep growl echoes through the darkness...\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-Two-students-standing-in-a-dark-basement,-holding-a-lantern,-with-ancient-chains-hanging-from-the-walls-and-shadows-moving-in-the-darkness.\"\n    },\n    {\n      \"chapterNumber\": 5,\n      \"title\": \"The Ritual Begins\",\n      \"textPrompt\": \"Ren, the student council president, is revealed to be involved in a dark ritual. Yuki and Akari witness him performing a ceremony in an abandoned classroom, chanting in the same unknown language from Yuki's dream...\",\n      \"imagePrompt\": \"Yuki,-Akari,-Ren,-anime-style,-dark-horror-illustration.-Three-students-in-an-abandoned-classroom,-with-Ren-performing-a-ritual-and-Yuki-and-Akari-watching-in-horror,-glowing-symbols-on-the-floor.\"\n    },\n     {\n      \"chapterNumber\": 6,\n      \"title\": \"The Entity Emerges\",\n      \"textPrompt\": \"During the ritual, The Entity begins to manifest, its shadowy form growing stronger. Akari senses its immense power and warns Yuki to flee, but it may already be too late...\",\n      \"imagePrompt\": \"Yuki,-Akari,-Ren,-The-Entity,-anime-style,-dark-horror-illustration.-A-shapeless-entity-with-glowing-red-eyes-emerging-from-a-dark-portal,-surrounded-by-terrified-students,-the-scene-is-filled-with-darkness-and-despair.\"\n    },\n    {\n      \"chapterNumber\": 7,\n      \"title\": \"Professor Kaede's Revelation\",\n      \"textPrompt\": \"Professor Kaede reveals his true purpose – he is a descendant of the school's founders and knows how to stop The Entity. He urges Yuki and Akari to trust him, even if his methods seem unorthodox...\",\n      \"imagePrompt\": \"Yuki,-Akari,-Professor-Kaede,-anime-style,-dark-horror-illustration.-Three-characters-standing-in-a-dimly-lit-room,-Professor-Kaede-holding-an-ancient-book,-explaining-a-solution-to-stop-the-Entity,-with-mysterious-symbols-glowing-around-them.\"\n    },\n    {\n      \"chapterNumber\": 8,\n      \"title\": \"Trapped in the Mirror Maze\",\n      \"textPrompt\": \"Ren, now fully possessed by The Entity, lures Yuki and Akari into a mirror maze within the school. The mirrors reflect their deepest fears, and the maze shifts and changes, trapping them in an endless nightmare...\",\n      \"imagePrompt\": \"Yuki,-Akari,-Ren,-anime-style,-dark-horror-illustration.-Two-students-trapped-in-a-mirror-maze,-their-reflections-showing-their-deepest-fears,-Ren-is-watching-them-with-a-malevolent-smile.\"\n    },\n    {\n      \"chapterNumber\": 9,\n      \"title\": \"The Scar's Power\",\n      \"textPrompt\": \"Yuki discovers that the scar on his wrist is an ancient mark capable of repelling The Entity. He struggles to control its power as he and Akari fight their way through the maze, facing their own inner demons...\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-Yuki's-scar-on-his-wrist-glowing-with-immense-power,-as-he-fights-shadowy-figures-in-the-mirror-maze,-Akari-stands-by-his-side,-ready-to-fight.\"\n    },\n    {\n      \"chapterNumber\": 10,\n      \"title\": \"A Deal with the Devil\",\n      \"textPrompt\": \"Desperate to escape the maze, Akari is tempted to make a deal with The Entity, promising her own soul in exchange for Yuki's safety. Will she sacrifice herself, or will Yuki find another way?\",\n      \"imagePrompt\": \"Yuki,-Akari,-The-Entity,-anime-style,-dark-horror-illustration.-Akari-standing-before-The-Entity,-offering-her-soul-in-exchange-for-Yuki's-safety,-Yuki-is-horrified-by-her-decision.\"\n    },\n    {\n      \"chapterNumber\": 11,\n      \"title\": \"The Twisted Playground\",\n      \"textPrompt\": \"Yuki refuses Akari's sacrifice, and they find themselves transported to a twisted version of the school's playground.  The swings creak ominously, and the slides lead to dark abysses.  They must navigate this hellish landscape to find a way back to reality.\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-A-twisted-version-of-a-school-playground,-with-creaking-swings-and-dark-abysses-where-slides-should-end,-the-sky-is-blood-red-and-ominous.\"\n    },\n    {\n      \"chapterNumber\": 12,\n      \"title\": \"Echoes of the Past\",\n      \"textPrompt\": \"Within the playground, Yuki and Akari encounter ghostly apparitions of past students who suffered under the school's dark history.  These echoes offer cryptic warnings and clues about The Entity's origin.\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-Two-students-confronted-by-ghostly-apparitions-of-past-students-in-a-twisted-playground,-the-ghosts-are-transparent-and-wailing.\"\n    },\n    {\n      \"chapterNumber\": 13,\n      \"title\": \"Ren's Confession\",\n      \"textPrompt\": \"A fragment of Ren's original personality surfaces, battling against The Entity's control.  He reveals the true nature of the ritual and how he was manipulated into summoning the darkness.\",\n      \"imagePrompt\": \"Yuki,-Akari,-Ren,-anime-style,-dark-horror-illustration.-Ren-struggling-against-the-Entity's-possession,-a-fragment-of-his-true-self-showing-through,-his-eyes-filled-with-remorse-and-fear.\"\n    },\n    {\n      \"chapterNumber\": 14,\n      \"title\": \"The Labyrinth of Despair\",\n      \"textPrompt\": \"Following Ren's clues, Yuki and Akari enter a labyrinth representing the school's history of despair.  Each corridor embodies a different tragic event, testing their courage and sanity.\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-Two-students-lost-in-a-labyrinth-made-of-nightmarish-imagery-representing-past-tragedies,-the-corridors-are-claustrophobic-and-oppressive.\"\n    },\n    {\n      \"chapterNumber\": 15,\n      \"title\": \"Kaede's Gambit\",\n      \"textPrompt\": \"Professor Kaede prepares a dangerous counter-ritual, risking his own life to weaken The Entity.  He instructs Yuki and Akari to gather specific artifacts from around the school to complete his plan.\",\n      \"imagePrompt\": \"Yuki,-Akari,-Professor-Kaede,-anime-style,-dark-horror-illustration.-Professor-Kaede-preparing-a-dangerous-ritual-in-a-secret-chamber,-glowing-symbols-scattered-around-him,-Yuki-and-Akari-are-gathering-artifacts.\"\n    },\n    {\n      \"chapterNumber\": 16,\n      \"title\": \"The Broken Clock Tower\",\n      \"textPrompt\": \"One of the artifacts is located at the top of the school's broken clock tower. Climbing the treacherous stairs, Yuki and Akari encounter warped time fragments, showing glimpses of the school's darkest moments.\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-Two-students-climbing-a-broken-clock-tower,-warped-time-fragments-showing-glimpses-of-past-tragedies,-the-tower-is-crumbling-and-ominous.\"\n    },\n    {\n      \"chapterNumber\": 17,\n      \"title\": \"The Puppeteer's Chamber\",\n      \"textPrompt\": \"Another artifact lies hidden within the old drama club's chamber, now a macabre display of life-sized puppets representing past victims.  The puppets seem to move on their own, their eyes following Yuki and Akari.\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-A-macabre-chamber-filled-with-life-sized-puppets-representing-past-victims,-the-puppets-seem-to-move-on-their-own,-creating-a-sense-of-unease.\"\n    },\n    {\n      \"chapterNumber\": 18,\n      \"title\": \"The Fountain of Tears\",\n      \"textPrompt\": \"The final artifact is found at the bottom of a dried-up fountain in the courtyard, now filled with the tears of the school's tormented souls.  Touching the tears grants Yuki a vision of The Entity's true name and weakness.\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-horror-illustration.-A-dried-up-fountain-filled-with-glowing-tears-in-the-school-courtyard,-touching-the-tears-grants-Yuki-a-terrifying-vision.\"\n    },\n    {\n      \"chapterNumber\": 19,\n      \"title\": \"The Counter-Ritual\",\n      \"textPrompt\": \"With the artifacts gathered and Yuki knowing The Entity's true name, they join Professor Kaede in performing the counter-ritual.  The school shakes as the ritual clashes with The Entity's power.\",\n      \"imagePrompt\": \"Yuki,-Akari,-Professor-Kaede,-anime-style,-dark-horror-illustration.-Three-characters-performing-a-counter-ritual,-glowing-symbols-surrounding-them,-the-school-shakes-as-their-power-clashes-with-The-Entity.\"\n    },\n    {\n      \"chapterNumber\": 20,\n      \"title\": \"Showdown with The Entity\",\n      \"textPrompt\": \"The Entity confronts them, its form now more defined and terrifying. Yuki uses his scar and knowledge of its true name to weaken it, while Akari and Kaede fight off its influence.\",\n      \"imagePrompt\": \"Yuki,-Akari,-Professor-Kaede,-The-Entity,-anime-style,-dark-horror-illustration.-The-Entity-confronting-the-characters,-Yuki-uses-his-scar-and-knowledge-to-weaken-it,-Akari-and-Professor-Kaede-fight-off-its-influence.\"\n    },\n    {\n      \"chapterNumber\": 21,\n      \"title\": \"Ren's Sacrifice\",\n      \"textPrompt\": \"Ren, regaining full control of himself, makes the ultimate sacrifice.  He uses his remaining connection to The Entity to sever its link to the school, at the cost of his own life.\",\n      \"imagePrompt\": \"Ren,-The-Entity,-anime-style,-dark-horror-illustration.-Ren-sacrificing-himself-to-sever-The-Entity's-link-to-the-school,-his-form-glowing-with-a-powerful-energy.\"\n    },\n    {\n      \"chapterNumber\": 22,\n      \"title\": \"Banishing the Darkness\",\n      \"textPrompt\": \"With Ren's sacrifice, The Entity weakens, and Yuki, Akari, and Professor Kaede combine their power to banish it back to the realm from whence it came.  The school begins to heal.\",\n      \"imagePrompt\": \"Yuki,-Akari,-Professor-Kaede,-anime-style,-dark-horror-illustration.-Three-characters-combining-their-power-to-banish-The-Entity-back-to-its-realm,-the-school-is-healing-around-them.\"\n    },\n    {\n      \"chapterNumber\": 23,\n      \"title\": \"Aftermath\",\n      \"textPrompt\": \"In the aftermath, the school is forever changed.  The surviving students and faculty try to rebuild, forever scarred by the events but united in their shared experience.  Professor Kaede takes on a new role, guiding them forward.\",\n      \"imagePrompt\": \"Yuki,-Akari,-Professor-Kaede,-anime-style,-illustration.-The-characters-standing-in-the-rebuilt-school,-scarred-but-united,-the-sun-shining-through-the-windows,-symbolizing-hope-and-renewal.\"\n    },\n    {\n      \"chapterNumber\": 24,\n      \"title\": \"The Lingering Shadow\",\n      \"textPrompt\": \"Though The Entity is gone, a lingering shadow remains, a reminder of the darkness that nearly consumed the school. Yuki and Akari know that their fight is far from over, and they must remain vigilant.\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-dark-illustration.-Two-students-standing-in-the-school-courtyard,-a-lingering-shadow-lurking-in-the-background,-a-sense-of-unease-and-vigilance.\"\n    },\n     {\n      \"chapterNumber\": 25,\n      \"title\": \"A New Beginning?\",\n      \"textPrompt\": \"Life at Kuroyami Academy slowly returns to normal, but Yuki and Akari can't shake the feeling that something is still amiss. A mysterious new student arrives, bearing a familiar symbol, hinting at a continuation of their fight against the darkness.\",\n      \"imagePrompt\": \"Yuki,-Akari,-anime-style,-illustration.-Two-students-staring-at-a-new-student-arriving-at-the-school,-the-new-student-is-wearing-a-pendant-with-a-familiar-symbol-a-hint-of-darkness-to-come.\"\n    }\n  ]\n}\n```\n\nI have provided 25 chapters with text prompts and image prompts formatted as URLs. I also made sure to be consistent with the character descriptions throughout the story. The image prompts are designed to be used with AI image generation tools like Pollinations.ai, by pasting these URLs, so you can create the corresponding images. Good luck with your horror story!\n"},
        ],
      },
    ],
  });
